{% extends "base.html" %}

{% block content %}
<div class="jumbotron">
  <div class="container">
    <h1>{% trans %}Users{% endtrans %}</h1>
  </div>
</div>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      {% if q and field %}
      <h5 class="text-muted text-center">
        {% trans %}Searching for users with <strong>{{ field }}</strong> matching <strong>{{ q }}</strong>{% endtrans %}
      </h5>
      <h6 class="text-muted text-center pb-3">
        {% trans page=users.page, total=users.total %}Page {{ page }} of {{ total }} results{% endtrans %}
      </h6>
      {% endif %}

      {% with form = Forms.users.PublicUserSearchForm(field=field, q=q) %}
      <form method="GET" class="row justify-content-around align-items-center">
        <div class="mb-3 col-md-2">
          {{ form.field(class="form-select w-100") }}
        </div>
        <div class="mb-3 col-md-8">
          {{ form.q(class="form-control w-100", placeholder=form.q.description) }}
        </div>
        <div class="mb-3 col-md-2">
          <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-search" aria-hidden="true"></i>
          </button>
        </div>
      </form>
      {% endwith %}
    </div>
  </div>

  <hr>

  <div class="row">
    <div class="col-md-12">
      <div class="overflow-x-auto rounded-lg border border-border">
        <table class="w-full text-left text-sm text-foreground">
          <thead class="bg-card text-xs uppercase text-muted-foreground border-b border-border">
            <tr>
              <th class="px-6 py-3 font-semibold tracking-wider">{% trans %}User{% endtrans %}</th>
              <th class="px-6 py-3 font-semibold tracking-wider text-center">{% trans %}Website{% endtrans %}</th>
              <th class="hidden md:table-cell px-6 py-3 font-semibold tracking-wider">{% trans %}Affiliation{% endtrans
                %}</th>
              <th class="hidden md:table-cell px-6 py-3 font-semibold tracking-wider">{% trans %}Country{% endtrans %}
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border bg-background/50">
            {% for user in users.items %}
            <tr class="hover:bg-white/5 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                {% if scores_visible() %}
                <a href="{{ url_for('users.public', user_id=user.id) }}"
                  class="font-medium text-white hover:text-primary transition-colors">
                  {{ user.name | truncate(50) }}
                </a>
                {% else %}
                <span class="font-medium text-white">{{ user.name | truncate(50) }}</span>
                {% endif %}

                {% if user.bracket_id %}
                <span
                  class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-secondary/20 text-secondary">{{
                  user.bracket.name }}</span>
                {% endif %}

                {% if user.oauth_id %}
                <a href="https://majorleaguecyber.org/u/{{ user.name }}">
                  <span
                    class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-primary/20 text-primary">{%
                    trans %}Official{% endtrans %}</span>
                </a>
                {% endif %}
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-center">
                {% if user.website and (user.website.startswith('http://') or user.website.startswith('https://')) %}
                <a href="{{ user.website }}" target="_blank" rel="noopener"
                  class="text-muted-foreground hover:text-white transition-colors">
                  <i class="fas fa-external-link-alt" data-toggle="tooltip" data-placement="top"
                    title="{{ user.website }}"></i>
                </a>
                {% endif %}
              </td>

              <td class="hidden md:table-cell px-6 py-4 whitespace-nowrap text-muted-foreground">
                {% if user.affiliation %}
                <span data-toggle="tooltip" data-placement="top" title="{{ user.affiliation }}">
                  {{ user.affiliation | truncate(50) }}
                </span>
                {% endif %}
              </td>
              <td class="hidden md:table-cell px-6 py-4 whitespace-nowrap text-muted-foreground">
                {% if user.country %}
                <span>
                  <i class="flag-{{ user.country.lower() }}"></i>
                  {{ lookup_country_code(user.country) }}
                </span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {% if users.pages > 1 %}
  <div class="row">
    <div class="col-md-12">
      <div class="text-center">
        {% trans %}Page{% endtrans %} <br>

        {% if users.page != 1 %}
        <a href="{{ prev_page }}">&lt;&lt;&lt;</a>
        {% endif %}

        <select class="page-select">
          {% for page in range(1, users.pages + 1) %}
          <option {% if users.page==page %}selected{% endif %}>{{ page }}</option>
          {% endfor %}
        </select>

        {% if users.next_num %}
        <a href="{{ next_page }}">&gt;&gt;&gt;</a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ Assets.js("assets/js/users/list.js") }}
{% endblock %}