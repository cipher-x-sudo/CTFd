import{d as h,r as g,m as n,C as s,h as u,T as d,M as p,a as f}from"./index.js";import{e as m}from"./index2.js";import"./echarts.js";h.extend(g);function r(e){let a=new DOMParser().parseFromString(e,"text/html");return a.querySelectorAll('a[href*="://"]').forEach(i=>{i.setAttribute("target","_blank")}),a.documentElement.outerHTML}window.Alpine=n;n.store("challenge",{data:{view:"",solves:[]}});n.data("Hint",()=>({id:null,html:null,async showHint(e){if(e.target.open){let t=await s.pages.challenge.loadHint(this.id);if(t.errors){e.target.open=!1,s._functions.challenge.displayUnlockError(t);return}let a=t.data;if(a.content)this.html=r(a.html);else if(await s.pages.challenge.displayUnlock(this.id)){let i=await s.pages.challenge.loadUnlock(this.id);if(i.success){let c=(await s.pages.challenge.loadHint(this.id)).data;this.html=r(c.html)}else e.target.open=!1,s._functions.challenge.displayUnlockError(i)}else e.target.open=!1}}}));n.data("Challenge",()=>({id:null,next_id:null,submission:"",tab:null,solves:[],submissions:[],solution:null,response:null,share_url:null,max_attempts:0,attempts:0,ratingValue:0,selectedRating:0,ratingReview:"",ratingSubmitted:!1,async init(){u()},getStyles(){return{}},async showChallenge(){},async showSolves(){this.solves=n.store("challenge").data.solves||[]},async showSubmissions(){let e=await s.pages.users.userSubmissions("me",this.id);this.submissions=e.data,this.submissions.forEach(t=>(t.date=h(t.date).format("MMMM Do, h:mm:ss A"),t)),new d(this.$el).show()},getSolutionId(){return n.store("challenge").data.solution_id},getSolutionState(){return n.store("challenge").data.solution_state},setSolutionId(e){n.store("challenge").data.solution_id=e},async showSolution(){let e=this.getSolutionId();s._functions.challenge.displaySolution=t=>{this.solution=t.html,new d(this.$el).show()},await s.pages.challenge.displaySolution(e)},getNextId(){return n.store("challenge").data.next_id},async nextChallenge(){let e=p.getOrCreateInstance("[x-ref='challengeWindow']");e._element.addEventListener("hidden.bs.modal",t=>{n.nextTick(()=>{this.$dispatch("load-challenge",this.getNextId())})},{once:!0}),e.hide()},async getShareUrl(){let e={type:"solve",challenge_id:this.id};const l=(await(await s.fetch("/api/v1/shares",{method:"POST",body:JSON.stringify(e)})).json()).data.url;this.share_url=l},copyShareUrl(){navigator.clipboard.writeText(this.share_url);let e=f.getOrCreateInstance(this.$el);e.enable(),e.show(),setTimeout(()=>{e.hide(),e.disable()},2e3)},async submitChallenge(){this.response=await s.pages.challenge.submitChallenge(this.id,this.submission),await this.renderSubmissionResponse()},async renderSubmissionResponse(){if(this.response.data.status==="correct"&&(this.submission=""),this.getSolutionId()==null&&s.pages.challenge.checkSolution(this.getSolutionState(),n.store("challenge").data,this.response.data.status)){let e=await s.pages.challenge.getSolution(this.id);this.setSolutionId(e.id)}this.max_attempts>0&&this.response.data.status!="already_solved"&&this.response.data.status!="ratelimited"&&(this.attempts+=1),this.$dispatch("load-challenges")},async submitRating(){(await s.pages.challenge.submitRating(this.id,this.selectedRating,this.ratingReview)).value?(this.ratingValue=this.selectedRating,this.ratingSubmitted=!0):alert("Error submitting rating")}}));n.data("ChallengeBoard",()=>({loaded:!1,challenges:[],challenge:null,view:"list",searchQuery:"",currentChallengeId:null,recentSolves:[],async init(){this.challenges=await s.pages.challenges.getChallenges(),this.loaded=!0,window.location.hash&&this.handleHash()},handleHash(){let e=window.location.hash;if(!e){this.view="list";return}let t=decodeURIComponent(e.substring(1)),a=t.lastIndexOf("-");if(a>=0){let l=t.slice(a+1);l&&l!=="null"&&this.loadChallenge(l,!1)}else this.view="list"},handlePopState(e){this.handleHash()},getCategories(){const e=[];this.challenges.forEach(t=>{const{category:a}=t;e.includes(a)||e.push(a)});try{const t=s.config.themeSettings.challenge_category_order;if(t){const a=new Function(`return (${t})`);e.sort(a())}}catch(t){console.log("Error running challenge_category_order function"),console.log(t)}return e},getChallenges(e){let t=this.challenges;e!==null&&(t=t.filter(a=>a.category===e)),this.searchQuery&&(t=t.filter(a=>a.name.toLowerCase().includes(this.searchQuery.toLowerCase())||a.category.toLowerCase().includes(this.searchQuery.toLowerCase())));try{const a=s.config.themeSettings.challenge_order;if(a){const l=new Function(`return (${a})`);t.sort(l())}}catch(a){console.log("Error running challenge_order function"),console.log(a)}return t},async loadChallenges(){this.challenges=await s.pages.challenges.getChallenges()},async loadChallenge(e,t=!0){!e||e==="null"||(this.currentChallengeId=e,this.recentSolves=[],s.pages.challenge.loadSolves(e).then(a=>{Array.isArray(a)&&(a.forEach(l=>{l.date=h(l.date).fromNow()}),this.recentSolves=a,n.store("challenge").data.solves=a)}),this.renderGraph(e),await s.pages.challenge.displayChallenge(e,a=>{a.data.view=r(a.data.view),a.data.solves=this.recentSolves,n.store("challenge").data=a.data,n.nextTick(()=>{this.view="detail",t&&history.pushState(null,null,`#${a.data.name}-${e}`)})}))},async renderGraph(e){try{const t=await s.fetch(`/api/v1/challenges/${e}/statistics`);if(!t.ok){console.log("Statistics endpoint not available for this challenge.");return}const l=(await t.json()).data,i={grid:{left:"5%",right:"5%",top:"10%",bottom:"10%",containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(10, 10, 15, 0.9)",borderColor:"rgba(255, 255, 255, 0.1)",textStyle:{color:"#fff"}},xAxis:{type:"category",boundaryGap:!1,data:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],axisLine:{show:!1},axisLabel:{color:"rgba(255,255,255,0.4)",fontSize:10}},yAxis:{type:"value",splitLine:{lineStyle:{color:"rgba(255,255,255,0.05)",type:"dashed"}},axisLabel:{color:"rgba(255,255,255,0.4)",fontSize:10}},series:[{name:"Attempts",type:"line",smooth:!0,symbolSize:0,lineStyle:{color:"rgba(255,255,255,0.2)",width:2},areaStyle:{color:"rgba(255,255,255,0.05)"},data:[l.wrong||0,(l.wrong||0)+(l.solve||0),l.wrong||0,15,10,20,15]},{name:"Solves",type:"line",smooth:!0,symbolSize:6,itemStyle:{color:"#10b981"},lineStyle:{width:3},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(16,185,129,0.3)"},{offset:1,color:"rgba(16,185,129,0)"}]}},data:[0,2,5,3,l.solve||0,7,10]}]},o=document.getElementById("solve-graph");o&&m(o,i)}catch(t){console.log("Error rendering graph:",t)}},async refreshChallenge(){this.currentChallengeId&&await this.loadChallenge(this.currentChallengeId,!1)},goBack(){this.view="list",this.currentChallengeId=null,history.pushState(null,null,window.location.pathname+window.location.search)}}));n.start();
